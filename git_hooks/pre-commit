#!/usr/bin/env bash
set -e

# Get staged Python files
FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.py$' || true)

if [ -z "$FILES" ]; then
  exit 0
fi

echo "Running isort..."
isort $FILES

echo "Running black..."
black $FILES

# Re-stage files after formatting
git add $FILES

echo "Running ruff..."
RUFF_OUTPUT=$(ruff check $FILES || true)

if [ -n "$RUFF_OUTPUT" ]; then
  echo "❌ Ruff linting failed:"
  echo
  echo "$RUFF_OUTPUT"
  echo
  echo "Commit aborted. Fix the lint errors above."
  exit 1
fi

echo "✅ Pre-commit checks passed."
exit 0

